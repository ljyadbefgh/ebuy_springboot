webpackJsonp([31],{"/ySs":function(e,t){},"9bBU":function(e,t,a){a("mClu");var l=a("FeBl").Object;e.exports=function(e,t,a){return l.defineProperty(e,t,a)}},C4MV:function(e,t,a){e.exports={default:a("9bBU"),__esModule:!0}},KcDu:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("bOdI"),i=a.n(l),o=a("woOf"),n=a.n(o),s={name:"RolePurviewManage",data:function(){return{dialogFormVisible:!1,disabled:!0,roleId:"",table:{tableData:[],limit:10,page:1,total:0,hideOnSinglePage:!1},multipleSelection:[]}},methods:{openDialog:function(e){var t=this;this.dialogFormVisible=!0,this.roleId=e,this.$nextTick(function(){t.getRolePurviews()})},closeDialog:function(){this.dialogFormVisible=!1},opened:function(){},closed:function(){this.$emit("roleTableRefresh")},getRolePurviews:function(){var e=this;this.$axios.get("/api/backstage/rolemanage/"+this.roleId+"/rolePurviewRelationManage").then(function(t){var a=t.data;0===a.code&&(e.table.tableData=a.data,e.table.total=a.count,e.$nextTick(function(){var e=this;this.table.tableData.forEach(function(t){null!=t.id&&e.$refs.rolePurviewTable.toggleRowSelection(t,!0)})}))})},tableSelect:function(e,t){var a=this,l=e.length>0&&-1!==e.indexOf(t);l?this.$axios.post("/api/backstage/rolemanage/"+t.role.id+"/rolePurviewRelationManage/"+t.purview.id).then(function(e){var i=e.data;if(0===i.code){var o=i.data;a.$message({type:"success",message:"操作成功"}),t=n()(t,o)}else a.$refs.rolePurviewTable.toggleRowSelection(t,!l)}).catch(function(e){a.$refs.rolePurviewTable.toggleRowSelection(t,!l)}):this.$axios.delete("/api/backstage/rolemanage/"+t.role.id+"/rolePurviewRelationManage/"+t.purview.id).then(function(e){if(0===e.data.code){a.$message({type:"success",message:"操作成功"});var o=t.permissions;o.forEach(function(e){1==e.selected&&(e.selected=null)}),t=n()(t,{id:null},{createTime:null},i()({permissions:o},"permissions",o))}else a.$refs.rolePurviewTable.toggleRowSelection(t,!l)}).catch(function(e){a.$refs.rolePurviewTable.toggleRowSelection(t,!l)})},permissionsChange:function(e,t,a){var l=this;e?this.$axios.post("/api/backstage/rolemanage/"+t.role.id+"/rolePurviewRelationManage/"+t.purview.id+"/rolePurviewMethod/"+a.id).then(function(t){var i=t.data;if(0===i.code){i.data;l.$message({type:"success",message:"操作成功"})}else a.selected=!e}).catch(function(t){a.selected=!e}):this.$axios.delete("/api/backstage/rolemanage/"+t.role.id+"/rolePurviewRelationManage/"+t.purview.id+"/rolePurviewMethod/"+a.id).then(function(t){var i=t.data;if(0===i.code){i.data;l.$message({type:"success",message:"操作成功"})}else a.selected=!e}).catch(function(t){a.selected=!e})},tableSelectAll:function(e){var t=this;0==e.length?this.$axios.delete("/api/backstage/rolemanage/"+this.roleId+"/rolePurviewRelationManage").then(function(e){0===e.data.code&&t.$message({type:"success",message:"成功移除所有角色关系"}),t.getRolePurviews()}).catch(function(e){t.getRolePurviews()}):this.$axios.post("/api/backstage/rolemanage/"+this.roleId+"/rolePurviewRelationManage").then(function(e){0===e.data.code&&t.$message({type:"success",message:"成功为角色赋予所有权限关系"}),t.getRolePurviews()}).catch(function(e){t.getRolePurviews()})}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"菜单管理",visible:e.dialogFormVisible,"close-on-click-modal":!1,fullscreen:!0,align:"left"},on:{"update:visible":function(t){e.dialogFormVisible=t},opened:e.opened,closed:e.closed}},[a("div",{staticClass:"item"},[a("el-table",{ref:"rolePurviewTable",staticStyle:{width:"100%"},attrs:{data:e.table.tableData,stripe:"",border:""},on:{select:e.tableSelect,"select-all":e.tableSelectAll}},[a("el-table-column",{attrs:{type:"selection",width:"40",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"role.nameZH",label:"角色名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"purview.name",label:"权限名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"purview.url",label:"路径"}}),e._v(" "),a("el-table-column",{attrs:{prop:"purview.enabled",label:"是否启用"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.purview.enabled?a("el-tag",{attrs:{size:"medium",type:"success"}},[e._v("是")]):e._e(),e._v(" "),0==t.row.purview.enabled?a("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("否")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作权限",align:"center",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.permissions,function(l,i){return a("el-checkbox-button",{key:l.id,attrs:{label:l.name},on:{change:function(a){return e.permissionsChange(a,t.row,l)}},model:{value:l.selected,callback:function(t){e.$set(l,"selected",t)},expression:"item.selected"}},[e._v(e._s(l.name))])})}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}})],1)],1)])},staticRenderFns:[]};var c=a("VU/8")(s,r,!1,function(e){a("/ySs")},"data-v-4f0a5ea3",null);t.default=c.exports},bOdI:function(e,t,a){"use strict";t.__esModule=!0;var l,i=a("C4MV"),o=(l=i)&&l.__esModule?l:{default:l};t.default=function(e,t,a){return t in e?(0,o.default)(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}},mClu:function(e,t,a){var l=a("kM2E");l(l.S+l.F*!a("+E39"),"Object",{defineProperty:a("evD5").f})}});